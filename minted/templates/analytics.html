{% extends 'base_content.html' %}
{% block content %}

<div id = "container">
  <form action="{% url 'view_analytics' %}" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Update" class="btn btn-primary">
  </form>
</div>
<div id="container" style="width: 50%;">
  {{ pie_data|json_script:"dataVar" }}
  {{ pie_labels|json_script:"labelsVar" }}
  {{ chart_data|json_script:"lineVar" }}

  <canvas id="pie-chart"></canvas>
  <canvas id="line-graph"></canvas>
</div>

<script>
  var build_random_colours = function(numberOfColours){
    colours = [];
    for (var i = 0; i<numberOfColours; i++){
      r = Math.floor(Math.random() * 255);
      g = Math.floor(Math.random() * 255);
      b = Math.floor(Math.random() * 255);
      colours.push(`rgba(${r}, ${g}, ${b}, 0.8)`);
    }
    return colours;
  }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js" integrity="sha512-vBmx0N/uQOXznm/Nbkp7h0P1RfLSj0HQrFSzV8m7rOGyj30fYAOKHYvCNez+yM8IrfnW0TCodDEjRqf6fodf/Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
  debugger
  // Do we want a newer version for chartjs? newest version does not work with js below.
  // Move this to it's own javascript file.
  var pie_data = JSON.parse(document.getElementById('dataVar').textContent);
  var pie_labels = JSON.parse(document.getElementById('labelsVar').textContent);
  var colours = build_random_colours(pie_data.length);
  var config = {
    type: 'pie',
    data: {
      datasets: [{
        data: pie_data,
        backgroundColor: colours,
        label: 'Total'
      }],
      labels: pie_labels
    },
    options: {
      responsive: true
    }
  };


  var line_data = JSON.parse(document.getElementById('lineVar').textContent);
  var ctx = document.getElementById('line-graph').getContext('2d');
  var line_config = {
    type: 'line',
    data:{
      labels: line_data.labels,
      datasets: line_data.datasets
    },
    options: {
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
      }

    }
  };

  window.onload = function() {
    var ctx = document.getElementById('pie-chart').getContext('2d');
    window.myPie = new Chart(ctx, config);

    var ctx2 = document.getElementById('line-graph').getContext('2d');
    window.myLine = new Chart(ctx2, line_config);
  }

 

</script>

{% endblock %}
