{% extends 'base_content.html' %}
{% block content %}

<div id = "container">
  <form action="{% url 'view_analytics' %}" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Update" class="btn btn-primary">
  </form>
</div>
<div id="container" style="width: 50%;">
  {{ category_pie_chart_data|json_script:"pieChartData" }}
  {{ category_line_chart_data|json_script:"lineChartData" }}

  <canvas id="line-graph"></canvas>
  <canvas id="pie-chart"></canvas>
</div>

<script>
  var build_random_colours = function(numberOfColours){
    colours = [];
    for (var i = 0; i<numberOfColours; i++){
      r = Math.floor(Math.random() * 255);
      g = Math.floor(Math.random() * 255);
      b = Math.floor(Math.random() * 255);
      colours.push(`rgba(${r}, ${g}, ${b}, 0.8)`);
    }
    return colours;
  }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js" integrity="sha512-vBmx0N/uQOXznm/Nbkp7h0P1RfLSj0HQrFSzV8m7rOGyj30fYAOKHYvCNez+yM8IrfnW0TCodDEjRqf6fodf/Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
  debugger
  // Do we want a newer version for chartjs? newest version does not work with js below.
  // Move this to it's own javascript file.

  var pieChartData = JSON.parse(document.getElementById('pieChartData').textContent);
  var colours = build_random_colours(pieChartData.data.length);
  var config = {
    type: 'pie',
    data: {
      datasets: [{
        data: pieChartData.data,
        backgroundColor: colours,
        label: 'Total'
      }],
      labels: pieChartData.labels,
    },
    options: {
      responsive: true
    }
  };


  var line_data = JSON.parse(document.getElementById('lineChartData').textContent);

  for (var i=0; i< line_data.datasets.length; i++){
    line_data.datasets[i].backgroundColor = colours[i]
    line_data.datasets[i].borderColor = colours[i]
  
  }
  var ctx = document.getElementById('line-graph').getContext('2d');
  var line_config = {
    type: 'line',
    data:{
      labels: line_data.labels,
      datasets: line_data.datasets
    },
    options: {
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
      }

    }
  };

  window.onload = function() {
    var ctx = document.getElementById('pie-chart').getContext('2d');
    window.myPie = new Chart(ctx, config);

    var ctx2 = document.getElementById('line-graph').getContext('2d');
    window.myLine = new Chart(ctx2, line_config);
  }
</script>

{% endblock %}
